<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Courier POD Terminal</title>
<style>
body{background:black;color:#00ff00;font-family:monospace;font-weight:bold;padding:5px;margin:0}
#out{white-space:pre;line-height:1.2em;font-size:12px}
input.cmd{background:black;color:#00ff00;border:none;width:100%;font-family:monospace;font-weight:bold;font-size:12px;outline:none}
</style>
</head>
<body>

<div id="out">
Courier POD Terminal v1.0
Type HELP for commands.
&gt;
</div>

<form id="cmdForm" onsubmit="return runCmd();">
<input type="text" id="cmdInput" class="cmd" autocomplete="off">
</form>

<script>
var terminal = document.getElementById('out');
var input = document.getElementById('cmdInput');

var API = "https://script.google.com/macros/s/AKfycbyuNEpOksgP5xs_wdTBBv3MLPle_dFltxLhYI3F1ieVl97oQLZ-b7ZrGYklCh1FYKLnNA/exec"; // MUST be HTTP for Android 2.3.3
var session = {loggedIn:false, userid:"", passid:""};

function println(txt){ terminal.innerHTML += txt + "\n&gt;"; window.scrollTo(0,document.body.scrollHeight); }

function runCmd() {
    var cmd = input.value;
    println(cmd);
    input.value="";

    var parts = cmd.split(" ");
    var base = parts[0].toUpperCase();

    if(!session.loggedIn) {
        if(base=="LOGIN"){
            if(parts.length<3){ println("Usage: LOGIN <UserID> <PassID>"); return false; }
            session.userid = parts[1];
            session.passid = parts[2];
            session.loggedIn = true;
            println("Logged in as "+session.userid);
        } else if(base=="HELP") {
            println("Commands:\nLOGIN <UserID> <PassID>\nHELP");
        } else {
            println("Please LOGIN first.");
        }
    } else {
        if(base=="POD"){
            if(parts.length<6){ println("Usage: POD <FROM> <TO> <SERVICE> <STATUS> <NOTE> [SIGNATURE]"); return false; }
            var from=parts[1], to=parts[2], svc=parts[3].toUpperCase(), status=parts[4].toUpperCase(), note=parts[5], sig=parts[6]||"";

            if(status=="DL" && svc=="EXPRESS" && sig==""){ println("Signature required"); return false; }

            var xhr = new XMLHttpRequest();
            xhr.open("POST",API,true);
            xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
            xhr.onreadystatechange=function(){ if(xhr.readyState==4){ println(xhr.responseText); } };
            var data="userid="+session.userid+"&passid="+session.passid+"&from="+from+"&to="+to+"&service="+svc+"&status="+status+"&note="+note+"&signature="+sig;
            xhr.send(data);

        } else if(base=="TRACK"){
            if(parts.length<2){ println("Usage: TRACK <TRK>"); return false; }
            var trk=parts[1];
            var xhr = new XMLHttpRequest();
            xhr.open("GET",API+"?trk="+trk,true);
            xhr.onreadystatechange=function(){ if(xhr.readyState==4){ println(xhr.responseText); } };
            xhr.send(null);
        } else if(base=="LOGOUT"){ session.loggedIn=false; println("Logged out"); }
        else if(base=="HELP"){ println("Commands:\nPOD <FROM> <TO> <SERVICE> <STATUS> <NOTE> [SIGNATURE]\nTRACK <TRK>\nLOGOUT\nHELP"); }
        else { println("Unknown command: "+base); }
    }
    return false;
}
</script>

</body>
</html>
