<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Courier POD Terminal</title>
<style>
body{background:black;color:#00ff00;font-family:monospace;font-weight:bold;padding:5px;margin:0}
#terminal{white-space:pre;line-height:1.2em;font-size:12px;min-height:250px}
input.cmd{background:black;color:#00ff00;border:none;width:100%;font-family:monospace;font-weight:bold;font-size:12px;outline:none}
</style>
</head>
<body>

<div id="terminal">
Courier POD Terminal v1.0
Type UserID to login:
&gt;
</div>

<input type="text" id="cmdInput" class="cmd" autocomplete="off">

<script>
var terminal=document.getElementById('terminal');
var input=document.getElementById('cmdInput');

var API="https://script.google.com/macros/s/AKfycbyuNEpOksgP5xs_wdTBBv3MLPle_dFltxLhYI3F1ieVl97oQLZ-b7ZrGYklCh1FYKLnNA/exec";
var session={stage:"login", userid:"", passid:"", trk:"", status:"", note:"", signature:""};

function println(txt){
    terminal.innerHTML+=txt+"\n&gt;";
    window.scrollTo(0,document.body.scrollHeight);
    input.focus();
}

// force focus on load
window.onload=function(){ input.focus(); }

// handle Enter key
input.onkeydown=function(e){
    e = e || window.event;
    if(e.keyCode==13){
        processInput(input.value);
        input.value="";
        return false;
    }
};

function processInput(val){
    val=val.trim();
    if(val=="") return;

    switch(session.stage){
        case "login":
            session.userid=val;
            println("UserID entered. Now enter PassID:");
            session.stage="pass";
            break;

        case "pass":
            session.passid=val;
            println("Logged in as "+session.userid);
            println("Enter Tracking ID:");
            session.stage="trk";
            break;

        case "trk":
            session.trk=val;
            println("TRK: "+session.trk);
            println("Select Status: A=Accepted, T=In Transit, O=Out for Delivery, DL=Delivered");
            session.stage="status";
            break;

        case "status":
            var s=val.toUpperCase();
            if(["A","T","O","DL"].indexOf(s)<0){
                println("Invalid status. Enter A, T, O, or DL:");
                break;
            }
            session.status=s;

            // ask note inline
            println("Enter note (or leave blank) and press Enter:");
            session.stage="note";
            break;

        case "note":
            session.note=val;
            if(session.status=="DL"){
                println("Enter signature for EXPRESS (or leave blank) and press Enter:");
                session.stage="signature";
            } else {
                sendPOD();
            }
            break;

        case "signature":
            session.signature=val;
            sendPOD();
            break;
    }
}

function sendPOD(){
    var xhr=new XMLHttpRequest();
    xhr.open("POST",API,true);
    xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
    xhr.onreadystatechange=function(){
        if(xhr.readyState==4){
            println("Server Response: "+xhr.responseText);
            println("Enter next Tracking ID:");
            session.stage="trk";
            session.trk="";
            session.status="";
            session.note="";
            session.signature="";
        }
    };
    var data="userid="+encodeURIComponent(session.userid)+
             "&passid="+encodeURIComponent(session.passid)+
             "&trk="+encodeURIComponent(session.trk)+
             "&status="+encodeURIComponent(session.status)+
             "&note="+encodeURIComponent(session.note)+
             "&signature="+encodeURIComponent(session.signature);
    xhr.send(data);
}
</script>

</body>
</html>
