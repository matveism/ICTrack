<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>DashGo POD</title>

<style>
body{
    background:#cfd3d6;
    font-family:Tahoma, Arial, sans-serif;
    font-size:14px;
    margin:0;
    padding:8px;
}

.container{
    max-width:320px;
    margin:0 auto;
    background:#e6e6e6;
    border:2px solid #7a7a7a;
    box-shadow:inset 0 0 0 2px #fff;
    padding:10px;
}

.header{
    background:#2f4f6f;
    color:#fff;
    text-align:center;
    font-weight:bold;
    padding:6px;
    border:1px solid #000;
}

hr{
    border:0;
    border-top:1px solid #7a7a7a;
    margin:8px 0;
}

label{
    display:block;
    margin-top:6px;
    font-weight:bold;
}

input,select,button{
    width:100%;
    box-sizing:border-box;
    font-size:14px;
    padding:6px;
    margin-top:4px;
    border:2px solid #7a7a7a;
    background:#fff;
}

input[readonly]{
    background:#ddd;
}

button{
    background:#d4d0c8;
    font-weight:bold;
    cursor:pointer;
}

button:active{
    background:#bcbcbc;
}

.input-wrap{
    display:flex;
    gap:4px;
}

.scan-btn{
    width:48px;
    font-size:18px;
}

.hidden{display:none;}

.msg{
    margin-top:6px;
    font-size:13px;
    font-weight:bold;
}
</style>
</head>

<body>

<div class="container">

<div class="header">DashGo POD</div>

<hr>

<div id="loginBox">
    <label>CID</label>
    <input type="text" id="cid">

    <label>PID</label>
    <input type="text" id="pid">

    <button onclick="logon()">LOGON</button>
    <div id="loginMsg" class="msg"></div>
</div>

<div id="pickupBox" class="hidden">

    <label>Tracking ID</label>
    <div class="input-wrap">
        <input type="text" id="trk"
               placeholder="Tap to scan"
               onclick="scanBarcode()"
               onfocus="scanBarcode()"
               autocomplete="off">
        <button class="scan-btn" onclick="scanBarcode()">ðŸ“·</button>
    </div>

    <label>Date / Time</label>
    <input type="text" id="dt" readonly>

    <label>Location</label>
    <input type="text" id="loc">

    <label>Status</label>
    <select id="status" onchange="checkInitialsField()">
        <option>ITEM DATA RECEIVED</option>
        <option>ITEM HANDED TO COURIER</option>
        <option>ITEM SCANNED AT HUB</option>
        <option>ITEM IN TRANSIT</option>
        <option>ITEM OUT FOR DELIVERY</option>
        <option>ITEM DELIVERED</option>
    </select>

    <div id="initBox" class="hidden">
        <label>Recipient Initials</label>
        <input type="text" id="initials" maxlength="4">
    </div>

    <button onclick="submitPickup()">CONFIRM</button>
    <div id="pickupMsg" class="msg"></div>

</div>

</div>

<!-- ðŸ”Š BEEP -->
<audio id="beep">
<source src="data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAESsAACJWAAACABAAZGF0YQAAAAA=" type="audio/wav">
</audio>

<script>
var CID="",PID="";
var URL="https://script.google.com/macros/s/AKfycbzgBEwDq1Hwl1weE2YbjHgeHhv3GdELuVkRpGYwwrZ4VQo0V5KQtDLmnFSyIRpr5fwI/exec";

function scanBarcode(){
    var ret = encodeURIComponent(
        window.location.origin +
        window.location.pathname +
        "?SCAN_RESULT={CODE}"
    );
    window.location.href =
        "intent://scan/#Intent;" +
        "scheme=zxing;" +
        "package=com.google.zxing.client.android;" +
        "S.ret=" + ret + ";" +
        "end";
}

(function(){
    var q=window.location.search;
    if(q.indexOf("SCAN_RESULT=")>-1){
        var code=decodeURIComponent(q.split("SCAN_RESULT=")[1].replace(/\+/g," "));
        document.getElementById("trk").value=code;
        document.getElementById("trk").blur();

        try{
            var b=document.getElementById("beep");
            b.currentTime=0;
            b.play();
        }catch(e){}

        checkInitialsField();
        history.replaceState(null,null,window.location.pathname);
    }
})();

function dt(){
    var d=new Date();
    document.getElementById("dt").value=
        d.getFullYear()+"-"+(d.getMonth()+1)+"-"+d.getDate()+" "+
        d.getHours()+":"+d.getMinutes()+":"+d.getSeconds();
}

function logon(){
    CID=cid.value.trim();
    PID=pid.value.trim();
    if(!CID||!PID){alert("CID / PID REQUIRED");return;}

    var x=new XMLHttpRequest();
    x.open("POST",URL,true);
    x.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
    x.onreadystatechange=function(){
        if(x.readyState==4){
            if(x.responseText=="OK"){
                loginBox.style.display="none";
                pickupBox.style.display="block";
                dt();
            }else{
                loginMsg.innerHTML="INVALID LOGIN";
            }
        }
    };
    x.send("action=login&cid="+encodeURIComponent(CID)+"&pid="+encodeURIComponent(PID));
}

function checkInitialsField(){
    if(status.value==="ITEM DELIVERED"){
        initBox.style.display="block";
    }else{
        initBox.style.display="none";
        initials.value="";
    }
}

function submitPickup(){
    dt();
    if(!trk.value.trim()){alert("SCAN REQUIRED");return;}

    var x=new XMLHttpRequest();
    x.open("POST",URL,true);
    x.setRequestHeader("Content-Type","application/x-www-form-urlencoded");
    x.onreadystatechange=function(){
        if(x.readyState==4){
            pickupMsg.innerHTML=x.responseText;
        }
    };

    x.send(
        "action=pickup"+
        "&cid="+encodeURIComponent(CID)+
        "&pid="+encodeURIComponent(PID)+
        "&trk="+encodeURIComponent(trk.value)+
        "&dt="+encodeURIComponent(dt.value)+
        "&loc="+encodeURIComponent(loc.value)+
        "&status="+encodeURIComponent(status.value)+
        "&initials="+encodeURIComponent(initials.value.toUpperCase())
    );
}
</script>

</body>
</html>
